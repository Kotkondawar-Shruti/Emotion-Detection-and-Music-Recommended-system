<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI MoodMate</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        /* Simple loading spinner */
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 font-sans min-h-screen p-4 md:p-8">

    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-white mb-2">MoodMate</h1>
            <p class="text-lg text-purple-300">Get music recommendations based on your mood.</p>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Input Card -->
            <div class="bg-gray-800 shadow-xl rounded-lg p-6 mb-8">

                <!-- *** CHANGED: Reverted back to Text Area *** -->
                <div class="mb-4">
                    <label for="emotion-text" class="block text-sm font-medium text-gray-300 mb-2">How are you feeling?</label>
                    <textarea id="emotion-text" name="emotion-text" rows="3" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Type something like 'I am so happy today!'..."></textarea>
                </div>

                <!-- Button -->
                <button id="get-recommendations-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-md transition duration-300 ease-in-out flex items-center justify-center">
                    <span id="rec-btn-text">Get Recommendations</span>
                    <div id="rec-spinner" class="spinner hidden"></div>
                </button>
            </div>

            <!-- Error Container -->
            <div id="error-container" class="bg-red-800 border border-red-700 text-red-100 px-4 py-3 rounded-lg relative mb-6 hidden" role="alert">
                <strong class="font-bold">Oops!</strong>
                <span class="block sm:inline" id="error-text">Something went wrong.</span>
            </div>

            <!-- Results -->
            <div id="result-container" class="hidden">
                <!-- Detected Emotion -->
                <div class="bg-gray-800 rounded-lg p-6 mb-6">
                    <h2 class="text-xs font-semibold text-purple-300 uppercase tracking-wider mb-2">Detected Mood</h2>
                    <p id="detected-emotion" class="text-3xl font-bold text-white"></p>
                    <p class="text-sm text-gray-400 mt-1">
                        Recommending <span id="mapped-sentiment" class="font-medium text-gray-300"></span> songs.
                    </p>
                </div>

                <!-- Recommendations List -->
                <div>
                    <h2 class="text-xl font-semibold text-white mb-4">Here are some songs for you:</h2>
                    <ul id="recommendations-list" class="space-y-3">
                        <!-- JS will insert song items here -->
                    </ul>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- Get DOM Elements ---
        // *** CHANGED: Get the textarea ***
        const emotionText = document.getElementById('emotion-text');
        const getRecommendationsBtn = document.getElementById('get-recommendations-btn');
        const recBtnText = document.getElementById('rec-btn-text');
        const recSpinner = document.getElementById('rec-spinner');

        const errorContainer = document.getElementById('error-container');
        const errorText = document.getElementById('error-text');

        const resultContainer = document.getElementById('result-container');
        const detectedEmotion = document.getElementById('detected-emotion');
        const mappedSentiment = document.getElementById('mapped-sentiment');
        const recommendationsList = document.getElementById('recommendations-list');

        // --- Add Event Listener ---
        getRecommendationsBtn.addEventListener('click', async() => {
            // *** CHANGED: Get value from the textarea ***
            const text = emotionText.value;

            // --- 1. Validation ---
            if (!text || text.trim() === '') {
                showError('Please type how you are feeling.');
                return;
            }
            showError(null); // Clear previous errors
            setLoading(true);

            // --- 2. API Call ---
            try {
                const response = await fetch('/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // *** CHANGED: Send the text ***
                    body: JSON.stringify({
                        text: text
                    }),
                });

                if (!response.ok) {
                    const errData = await response.json();
                    throw new Error(errData.error || `Server error: ${response.status}`);
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) { // There was a syntax error here, fixed it.
                console.error('Fetch error:', error);
                showError(error.message);
            } finally {
                setLoading(false);
            }
        });

        // --- 3. Display Results (This function is mostly the same) ---
        function displayResults(data) {
            // Clear previous results
            recommendationsList.innerHTML = '';

            // Set emotion and sentiment
            detectedEmotion.textContent = data.emotion; // e.g., "Joy"
            mappedSentiment.textContent = data.mapped_sentiment; // e.g., "Happy"

            // Populate song list
            if (!data.songs || data.songs.length === 0) {
                recommendationsList.innerHTML = '<li class="text-gray-400">No song recommendations found for this mood.</li>';
            } else {
                data.songs.forEach(song => {
                    const li = document.createElement('li');
                    li.className = 'bg-gray-800 p-4 rounded-lg flex items-center justify-between shadow';
                    li.innerHTML = `
                        <div>
                            <span class="font-medium text-white">${song.name}</span>
                            <span class="block text-sm text-gray-400">${song.artist}</span>
                        </div>

                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-300" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                        </svg>
                    `;
                    recommendationsList.appendChild(li);
                });
            }
            resultContainer.classList.remove('hidden');
        }

        // --- Utility Functions for UI state ---\

        function setLoading(isLoading) {
            if (isLoading) {
                recBtnText.classList.add('hidden');
                recSpinner.classList.remove('hidden');
                getRecommendationsBtn.disabled = true;
            } else {
                recBtnText.classList.remove('hidden');
                recSpinner.classList.add('hidden');
                getRecommendationsBtn.disabled = false;
            }
        }

        function showError(message) {
            if (message) {
                errorText.textContent = message;
                errorContainer.classList.remove('hidden');
            } else {
                errorContainer.classList.add('hidden');
            }
        }
    </script>
</body>

</html>